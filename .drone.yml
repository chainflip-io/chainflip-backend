kind: pipeline
type: docker
name: chainflip-backend

steps:
  - name: build
    image: plugins/docker
    environment:
      AWS_ACCESS_KEY_ID:
        from_secret: aws_access_key_id
      AWS_SECRET_ACCESS_KEY:
        from_secret: aws_secret_access_key
    settings:
      username:
        from_secret: docker_username
      password:
        from_secret: docker_password
      repo: ghcr.io/chainflip-io/chainflip-backend/state-chain
      registry: ghcr.io
      tags: latest
      cache_from: ghcr.io/chainflip-io/chainflip-backend/state-chain
      build_args_from_env:
        - AWS_ACCESS_KEY_ID
        - AWS_SECRET_ACCESS_KEY
trigger:
  event:
    - push
