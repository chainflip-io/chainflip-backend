name: Get 1Password Secrets

on: workflow_call
jobs:
  get-secrets:
    runs-on: ubuntu-latest
    outputs:
      BASHFUL_SIGNING_KEY: ${{ steps.load-secrets.outputs.BASHFUL_SIGNING_KEY}}
      CF_DEV_PGP_KEY: ${{ steps.load-secrets.outputs.CF_DEV_PGP_KEY}}
      ETH_PRIVATE_KEY: ${{ steps.load-secrets.outputs.ETH_PRIVATE_KEY}}
      ETH__HTTP_NODE_ENDPOINT: ${{ steps.load-secrets.outputs.ETH__HTTP_NODE_ENDPOINT}}
      ETH__NODE_ENDPOINT: ${{ steps.load-secrets.outputs.ETH__NODE_ENDPOINT}}
      ETH__WS_NODE_ENDPOINT: ${{ steps.load-secrets.outputs.ETH__WS_NODE_ENDPOINT}}
      NODE_KEY: ${{ steps.load-secrets.outputs.NODE_KEY}}
      SCCACHE_REDIS: ${{ steps.load-secrets.outputs.SCCACHE_REDIS}}
    steps:
      - name: Checkout üèÅ
        uses: actions/checkout@v3

      - name: Setup Tailscale ü™° ‚öôÔ∏è
        id: tailscale
        uses: tailscale/github-action@main
        with:
          authkey: ${{ secrets.CF_TAILSCALE_AUTHKEY }}

      - name: Load secret üóùüë®‚Äçüíª
        uses: 1password/load-secrets-action@v1
        id: load-secrets
        env:
          OP_CONNECT_HOST: ${{ secrets.CF_1PASSWORD_CONNECTOR_URL }}
          OP_CONNECT_TOKEN: ${{ secrets.CF_1PASSWORD_CONNECTOR_TOKEN_READ_ONLY }}
          BASHFUL_SIGNING_KEY: op://github-actions/CF_BASHFUL_SIGNING_KEY/password
          CF_DEV_PGP_KEY: op://github-actions/CF_DEV_PGP_KEY
          ETH_PRIVATE_KEY: op://github-actions/CF_ETH_PRIVATE_KEY/password
          ETH__HTTP_NODE_ENDPOINT: op://github-actions/CF_ETH__HTTP_NODE_ENDPOINT/password
          ETH__NODE_ENDPOINT: op://github-actions/CF_ETH__NODE_ENDPOINT/password
          ETH__WS_NODE_ENDPOINT: op://github-actions/CF_ETH__WS_NODE_ENDPOINT/password
          NODE_KEY: op://github-actions/CF_NODE_KEY/password
          SCCACHE_REDIS: op://github-actions/CF_SCCACHE_REDIS/password