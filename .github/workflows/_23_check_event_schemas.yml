name: Ensure event schemas are up to date

on:
  workflow_call:

permissions:
  packages: read
  contents: read

jobs:
  check-event-schemas:
    runs-on: namespace-profile-default
    steps:
      - name: Checkout chainflip-backend ğŸ›’
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11

      - name: Download Binaries ğŸ“¥
        uses: actions/download-artifact@fa0a91b85d4f404e444e00e005971372dc801d16
        with:
          name: chainflip-backend-bin

      - name: Make Binaries Executable ğŸ› ï¸
        run: |
          chmod +x chainflip-*

      - name: Configure NodeJS ğŸ› ï¸
        uses: actions/setup-node@2028fbc5c25fe9cf00d9f06a71cc4710d4507903
        with:
          node-version-file: ./bouncer/.nvmrc
          cache-dependency-path: "bouncer/pnpm-lock.yaml"

      - uses: pnpm/action-setup@v4
        with:
          version: 9

      - name: Install node dependencies ğŸ“¦
        working-directory: bouncer
        run: pnpm install

      - name: Run Test ğŸ§ª
        shell: bash
        run: ./ci/scripts/check_event_schemas.sh
