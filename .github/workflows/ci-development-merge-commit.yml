name: Chainflip Tests on Merge Commit
on:
  pull_request:
    branches:
      - main
      - 'release/*'

concurrency:
  group: ${{ github.ref }}-merge-commit
  cancel-in-progress: true

jobs:
  pre-check:
    uses: ./.github/workflows/_01_pre_check.yml
    secrets: inherit
  test:
    uses: ./.github/workflows/_10_test.yml
    secrets: inherit
    with:
      checkout_merge_commit: true
  build:
    uses: ./.github/workflows/_20_build.yml
    secrets: inherit
    with:
      network: development
      commit_hash: ${{ github.sha }}
      checkout_merge_commit: true
  post-check:
    needs: [build]
    uses: ./.github/workflows/_40_post_check.yml
    secrets: inherit
    with:
      simple_bouncer: false
      checkout_merge_commit: true
