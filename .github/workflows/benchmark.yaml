name: "Run Benchmarks"
on:
  workflow_dispatch:
    inputs:
      circleCiArtifactUrl:
        description: 'Which CircleCI job should we get the binaries from?'
        required: true
        type: string

jobs:
  run_benchmarks:
    env:
      CIRCLE_TOKEN: ${{ secrets.CIRCLE_TOKEN }}
      CIRCLE_CI_ARTIFACT_URL: ${{ github.event.inputs.circleCiArtifactUrl }}

    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Download binary to benchmark
        run: |
          curl -sL -o chainflip-node -H "Circle-Token: $CIRCLE_TOKEN" $CIRCLE_CI_ARTIFACT_URL
          chmod +x chainflip-node
          ls -al

      - name: Run benchmarks
        run: |
          ./chainflip-node --help
          ./state-chain/scripts/benchmark-all.sh ./chainflip-node